
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Plot TFRs &#8212; tfrStats 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo_2.jpg" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Content:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../uvtfrs.html">1. On TFR statistical assessments</a></li>
<li class="toctree-l1"><a class="reference internal" href="univariate_tfr_stats.html">2. Univariate TFR statistics, a mini-tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="multivariate_tfr_stats.html">3. Multiviariate TFR statistics, a mini-tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../refs.html">4. <strong>References</strong></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">tfrStats</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="Plot-TFRs">
<h1>Plot TFRs<a class="headerlink" href="#Plot-TFRs" title="Permalink to this heading">Â¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">tqdm.auto</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp2d</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">scipy.io</span> <span class="k">as</span> <span class="nn">sio</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">Normalize</span>
<span class="kn">import</span> <span class="nn">lamidec</span>
<span class="c1">#from  lamidec.tfr_stats import tfr_stats</span>
<span class="kn">from</span>  <span class="nn">lamidec.tfr_spw</span> <span class="kn">import</span> <span class="n">tfr_spw</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>
<span class="kn">from</span> <span class="nn">statsmodels.distributions.empirical_distribution</span> <span class="kn">import</span> <span class="n">ECDF</span>
<span class="c1">#from tfrStats.load_uv_tfrs import load_uv_tfrs as load_uv_tfrs</span>
<span class="kn">from</span> <span class="nn">tfrStats.get_pvals_whole</span> <span class="kn">import</span> <span class="n">get_pvals_whole</span> <span class="k">as</span> <span class="n">get_pvals_whole</span>
<span class="kn">from</span> <span class="nn">tfrStats.get_pvals_minmax</span> <span class="kn">import</span> <span class="n">get_pvals_minmax</span> <span class="k">as</span> <span class="n">get_pvals_minmax</span>
<span class="kn">from</span> <span class="nn">tfrStats.get_dpvals_whole</span> <span class="kn">import</span> <span class="n">get_dpvals_whole</span> <span class="k">as</span> <span class="n">get_dpvals_whole</span>
<span class="kn">from</span> <span class="nn">tfrStats.get_dpvals_minmax</span> <span class="kn">import</span> <span class="n">get_dpvals_minmax</span> <span class="k">as</span> <span class="n">get_dpvals_minmax</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span><span class="k">def</span> <span class="nf">load_uv_tfrs</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="n">svar</span><span class="p">,</span> <span class="n">cond</span><span class="p">,</span> <span class="n">fband</span><span class="p">,</span> <span class="n">obs</span><span class="p">):</span>




    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load empirical and null TFRs</span>

<span class="sd">    This functions loads the results of tfr_spw_stats_minmax or load_uv_tfrs</span>


<span class="sd">    .. todo::</span>
<span class="sd">        * Handle parameters with dictionary.</span>


<span class="sd">    :param string input_path: path to the .npz file.</span>
<span class="sd">    :param in condition: condition index (i.e. 0, 1, 2, 3).</span>
<span class="sd">    :param int svar: spectral power or GPR (not implemented here).</span>
<span class="sd">    :param int fband: frequency band index (i.e. low, high, higher).</span>
<span class="sd">    :param int obs: [nullType, percentile], two integeres: 0 for min-max, 1 for whole, 0-100 percentile</span>


<span class="sd">    :return: empirical time frequency representation n_conds x n_sites x n_freqs x n_time (i.e. 30, 12, 16, 113).</span>
<span class="sd">    :return: null time frequency representation (i.e. 30, 12, 16, 113  or 1000, 30, 12, 16, 2).</span>
<span class="sd">    :rtype: float</span>

<span class="sd">    @author: Nicolas Gravel, 19.09.2023</span>
<span class="sd">    &quot;&quot;&quot;</span>



    <span class="n">blocks</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;grat&#39;</span><span class="p">,</span> <span class="s1">&#39;nat&#39;</span><span class="p">,</span><span class="s1">&#39;nat&#39;</span><span class="p">,</span><span class="s1">&#39;nat&#39;</span><span class="p">,</span><span class="s1">&#39;nat&#39;</span><span class="p">,</span><span class="s1">&#39;nat&#39;</span><span class="p">]</span>
    <span class="n">conds</span>   <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gratings&#39;</span><span class="p">,</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span><span class="s1">&#39;scenes&#39;</span><span class="p">,</span><span class="s1">&#39;objects&#39;</span><span class="p">]</span>
    <span class="n">svars</span>   <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;spw&#39;</span><span class="p">,</span> <span class="s1">&#39;gpr&#39;</span><span class="p">]</span>
    <span class="n">fbands</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="s1">&#39;high&#39;</span><span class="p">,</span><span class="s1">&#39;higher&#39;</span><span class="p">]</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_100&#39;</span><span class="p">,</span> <span class="s1">&#39;_500_minmax&#39;</span><span class="p">,</span> <span class="s1">&#39;_100_minmax_roll&#39;</span><span class="p">]</span>
    <span class="n">svar</span>    <span class="o">=</span> <span class="mi">0</span>


    <span class="n">fname</span>   <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_path</span> <span class="o">+</span><span class="s1">&#39;uvtfr_stats_&#39;</span> <span class="o">+</span>    <span class="n">fbands</span><span class="p">[</span><span class="n">fband</span><span class="p">]</span>  <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">blocks</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">svars</span><span class="p">[</span><span class="n">svar</span><span class="p">]</span> <span class="o">+</span> <span class="n">results</span><span class="p">[</span><span class="n">obs</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.npz&#39;</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">conds</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;objects&#39;</span><span class="p">:</span>
        <span class="n">trialIdx_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
        <span class="n">trialIdx</span> <span class="o">=</span> <span class="n">trialIdx_</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Objects</span>
        <span class="c1">#trialIdx = trialIdx[trgt]</span>
    <span class="k">if</span> <span class="n">conds</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span><span class="o">==</span> <span class="s1">&#39;scenes&#39;</span><span class="p">:</span>
        <span class="n">trialIdx_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
        <span class="n">trialIdx</span> <span class="o">=</span> <span class="n">trialIdx_</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>   <span class="c1"># Scenes</span>
        <span class="c1">#trialIdx = trialIdx[trgt]</span>
    <span class="k">if</span> <span class="n">conds</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
        <span class="n">trialIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">conds</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;gratings&#39;</span><span class="p">:</span>
        <span class="n">trialIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;stats :&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="n">npz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>

    <span class="c1"># Empirical TFR</span>
    <span class="n">tfr</span>      <span class="o">=</span> <span class="n">npz</span><span class="p">[</span><span class="s1">&#39;arr_0&#39;</span><span class="p">]</span>
    <span class="n">tfr_emp</span>  <span class="o">=</span>  <span class="n">tfr</span><span class="p">[</span><span class="n">trialIdx</span><span class="p">,:,:,:]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tfr emp  : &#39;</span><span class="p">,</span> <span class="n">tfr_emp</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="c1"># Null TFR</span>
    <span class="n">tfr</span>      <span class="o">=</span> <span class="n">npz</span><span class="p">[</span><span class="s1">&#39;arr_1&#39;</span><span class="p">]</span>
    <span class="n">tfr_null</span> <span class="o">=</span> <span class="n">tfr</span><span class="p">[:,</span><span class="n">trialIdx</span><span class="p">,:,:,:]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tfr null   :&#39;</span><span class="p">,</span> <span class="n">tfr_null</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>


    <span class="k">return</span> <span class="n">tfr_emp</span><span class="p">,</span> <span class="n">tfr_null</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><br/><span></span><span class="k">def</span> <span class="nf">coloroffset</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Ensure k is between 0 and 1</span>
        <span class="n">point</span> <span class="o">=</span> <span class="n">min_val</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">max_val</span> <span class="o">-</span> <span class="n">min_val</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;For k=</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">, the point in the range </span><span class="si">{</span><span class="n">min_val</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">max_val</span><span class="si">}</span><span class="s1"> is: </span><span class="si">{</span><span class="n">point</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: k must be between 0 and 1&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">point</span>


<span class="k">def</span> <span class="nf">plot_uvtfr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Computes and report time-frequency representations of univariate statistics</span>


<span class="sd">    Args:</span>
<span class="sd">       tfr_emp, tfr_null</span>


<span class="sd">    Returns:</span>
<span class="sd">        empirical and null TFRs (if &#39;compute_tfrs&#39;     : True and &#39;null&#39;     : 2)</span>
<span class="sd">        plot TFRs with noise cutoff (if there is an input TFR , if TFR &#39;compute_tfrs&#39;     : False and &#39;null&#39;     : 2)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">twindow</span>    <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;twindow&#39;</span><span class="p">]</span>
    <span class="n">tclust</span>    <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;tclust&#39;</span><span class="p">]</span>
    <span class="n">cutoff</span>   <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;cutoff&#39;</span><span class="p">]</span>
    <span class="n">prctl</span>    <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;prctl&#39;</span><span class="p">]</span>
    <span class="n">fbands</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="s1">&#39;high&#39;</span><span class="p">,</span><span class="s1">&#39;higher&#39;</span><span class="p">,</span><span class="s1">&#39;mua&#39;</span><span class="p">]</span>
    <span class="n">blocks</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;grat&#39;</span><span class="p">,</span> <span class="s1">&#39;nat&#39;</span><span class="p">,</span><span class="s1">&#39;nat&#39;</span><span class="p">,</span><span class="s1">&#39;nat&#39;</span><span class="p">,</span><span class="s1">&#39;nat&#39;</span><span class="p">]</span>
    <span class="n">conds</span>   <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;grat&#39;</span><span class="p">,</span><span class="s1">&#39;bck-obj&#39;</span><span class="p">,</span> <span class="s1">&#39;bck&#39;</span><span class="p">,</span><span class="s1">&#39;obj&#39;</span><span class="p">,</span><span class="s1">&#39;grat_lowcon&#39;</span><span class="p">,</span><span class="s1">&#39;grat_highcon&#39;</span><span class="p">,</span><span class="s1">&#39;bckXobj&#39;</span><span class="p">]</span>
    <span class="n">paths</span>   <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;paths&#39;</span><span class="p">]</span>
    <span class="n">cond</span>  <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;cond&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="n">cond</span><span class="p">],</span><span class="n">conds</span><span class="p">[</span><span class="n">cond</span><span class="p">])</span>
    <span class="n">coloffset</span>  <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;coloffset&#39;</span><span class="p">]</span>
    <span class="n">cnorm_range</span>    <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;cnorm_range&#39;</span><span class="p">]</span>
    <span class="n">null</span>   <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;null&#39;</span><span class="p">]</span>
    <span class="n">stat</span>  <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;stats&#39;</span><span class="p">]</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;p_val&#39;</span><span class="p">]</span>
    <span class="n">cmap</span>   <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span>
    <span class="n">compute_tfrs</span>    <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;compute_tfrs&#39;</span><span class="p">]</span>
    <span class="n">decvars</span>  <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;decvars&#39;</span><span class="p">]</span>
    <span class="n">dvar</span>  <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;dvar&#39;</span><span class="p">]</span>
    <span class="n">sess</span>   <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;sess&#39;</span><span class="p">]</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
    <span class="n">img_type</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;img_type&#39;</span><span class="p">]</span>
    <span class="n">cnorm</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;cnorm&#39;</span><span class="p">]</span>
    <span class="n">max_pwr</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s1">&#39;max_pwr&#39;</span><span class="p">]</span>

    <span class="c1">#cond       = 1</span>
    <span class="c1">#fband      = 0</span>
    <span class="n">stat</span>       <span class="o">=</span> <span class="mi">4</span>
    <span class="n">cutoff</span>     <span class="o">=</span> <span class="mi">95</span>
    <span class="n">pval</span>       <span class="o">=</span> <span class="mf">0.05</span>
    <span class="n">ups</span>        <span class="o">=</span> <span class="mi">4</span>
    <span class="n">twindow</span>    <span class="o">=</span> <span class="p">[</span><span class="mi">65</span><span class="p">,</span> <span class="mi">80</span><span class="p">]</span>
    <span class="n">tps</span>        <span class="o">=</span> <span class="p">[</span><span class="mi">57</span><span class="p">,</span><span class="mi">113</span><span class="p">,</span><span class="mi">141</span><span class="p">,</span><span class="mi">140</span><span class="p">]</span>
    <span class="n">fps</span>        <span class="o">=</span> <span class="p">[</span><span class="mi">19</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">lp</span>         <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">80</span><span class="p">]</span>
    <span class="n">hp</span>         <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
    <span class="c1">#cnorm_range = [400, 1000]</span>
    <span class="n">fr</span>         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(([</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">]))</span>        <span class="c1"># indices for theta, gamma &amp; high gamma</span>
    <span class="n">cmap</span>       <span class="o">=</span> <span class="s1">&#39;cubehelix_r&#39;</span>
    <span class="n">coloff</span>     <span class="o">=</span> <span class="mf">0.5</span>        <span class="c1"># colormap center offset</span>
    <span class="n">stats_range</span>   <span class="o">=</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span> <span class="c1"># range for thresholding (interval or &quot;cluster&quot; to compute the threshold)</span>
    <span class="n">overlay_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># range for overlay coverage</span>
    <span class="c1">#alpha         = 0.5     # overlay alpha</span>
    <span class="n">calpha</span>        <span class="o">=</span> <span class="mf">0.25</span>


    <span class="n">ups</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">n_depths</span> <span class="o">=</span> <span class="mi">12</span>


    <span class="c1"># =============================================================================</span>
    <span class="c1"># How the indices are organized within the dataset</span>
    <span class="c1"># =============================================================================</span>
           <span class="c1"># Conditions</span>
    <span class="k">if</span> <span class="n">cond</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">block</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">n_sess</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="c1">#trialIdx = cond_idx[:,4] # np.arange(30)</span>
        <span class="n">trialIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">trialIdx</span> <span class="c1">#[10:30]  # Gratings</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">c1</span>        <span class="c1"># Gratings</span>
    <span class="c1"># Object and scenes indices were fliped during the creation of: &#39;ftPool_&#39; + cond + ...  + &#39;.mat&#39;</span>
    <span class="c1"># =============================================================================</span>
    <span class="k">elif</span> <span class="n">cond</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">block</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n_sess</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="n">trialIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">trialIdx</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>   <span class="c1"># Scenes</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">c1</span>
    <span class="k">elif</span> <span class="n">cond</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">block</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n_sess</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="n">trialIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
        <span class="n">c1</span><span class="o">=</span> <span class="n">trialIdx</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Objects</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">c1</span>
    <span class="c1"># =============================================================================</span>
    <span class="k">elif</span> <span class="n">cond</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">block</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n_sess</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="n">trialIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">trialIdx</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>   <span class="c1"># Scenes</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">trialIdx</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># Objects</span>
    <span class="k">elif</span> <span class="n">cond</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">block</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">n_sess</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="c1">#trialIdx = cond_idx[:,4] # np.arange(30)</span>
        <span class="n">trialIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">trialIdx</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span>  <span class="c1"># Gratings</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">c1</span>        <span class="c1"># Gratings</span>
    <span class="k">elif</span> <span class="n">cond</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">block</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">n_sess</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="c1">#trialIdx = cond_idx[:,4] # np.arange(30)</span>
        <span class="n">trialIdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">trialIdx</span><span class="p">[</span><span class="mi">19</span><span class="p">:</span><span class="mi">30</span><span class="p">]</span>  <span class="c1"># Gratings</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">c1</span>        <span class="c1"># Gratings</span>
    <span class="n">channels</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">n_sess</span><span class="p">)]</span> <span class="c1"># Total channels</span>
    <span class="n">site_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">12</span><span class="p">,</span><span class="n">n_sess</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint</span><span class="p">)</span> <span class="c1"># Index to sites</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span> <span class="c1"># for time</span>
            <span class="n">site</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">channels</span> <span class="k">if</span> <span class="n">x</span><span class="o">%</span><span class="k">12</span> == n]
            <span class="n">site_idx</span><span class="p">[</span><span class="n">n</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">site</span>
            <span class="c1">#print(site)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sites x sessions: &quot;</span><span class="p">,</span><span class="n">site_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Site indices: &quot;</span><span class="p">,</span> <span class="n">site_idx</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Depth indices: &quot;</span><span class="p">,</span> <span class="n">site_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span><span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;wspace&#39;</span><span class="p">:</span><span class="mf">0.025</span><span class="p">,</span> <span class="s1">&#39;hspace&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">})</span>
    <span class="n">panel</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">fband</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>



        <span class="c1"># Load data</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Load data&#39;</span><span class="p">)</span>

        <span class="c1">#tfr_emp, tfr_null = load_uv_tfrs(input_path, [], cond, fband, [])</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;minmax_roll&#39;</span><span class="p">:</span>
            <span class="n">results</span>       <span class="o">=</span> <span class="mi">1</span>
            <span class="n">tfr_emp</span><span class="p">,</span> <span class="n">tfr_null</span> <span class="o">=</span> <span class="n">load_uv_tfrs</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="p">[],</span> <span class="n">cond</span><span class="p">,</span> <span class="n">fband</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span> <span class="c1"># load tfrs from .npz file</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;whole&#39;</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;whole_roll&#39;</span><span class="p">:</span>
            <span class="n">results</span>       <span class="o">=</span> <span class="mi">0</span>
            <span class="n">tfr_emp</span><span class="p">,</span> <span class="n">tfr_null</span> <span class="o">=</span> <span class="n">load_uv_tfrs</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="p">[],</span> <span class="n">cond</span><span class="p">,</span> <span class="n">fband</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span> <span class="c1"># load tfrs from .npz file</span>

        <span class="c1"># Getting p-values</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="n">get_pvals_minmax</span><span class="p">(</span><span class="n">tfr_emp</span><span class="p">,</span> <span class="n">tfr_null</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="s1">&#39;single-sided&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;minmax_roll&#39;</span><span class="p">:</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="n">get_pvals_minmax_roll</span><span class="p">(</span><span class="n">tfr_emp</span><span class="p">,</span> <span class="n">tfr_null</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="s1">&#39;single-sided&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;whole&#39;</span><span class="p">:</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="n">get_pvals_whole</span><span class="p">(</span><span class="n">tfr_emp</span><span class="p">,</span> <span class="n">tfr_null</span><span class="p">,</span> <span class="n">fband</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;whole_roll&#39;</span><span class="p">:</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="n">get_pvals_whole_roll</span><span class="p">(</span><span class="n">tfr_emp</span><span class="p">,</span> <span class="n">tfr_null</span><span class="p">,</span> <span class="n">fband</span><span class="p">)</span>



        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plot results&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;shape emp  :&#39;</span><span class="p">,</span> <span class="n">tfr_emp</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;shape null :&#39;</span><span class="p">,</span> <span class="n">tfr_null</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>


        <span class="c1"># indices for plotting</span>
        <span class="n">x</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">800</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">tps</span><span class="p">[</span><span class="n">fband</span><span class="p">])</span> <span class="c1"># time vector</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># time index for induced power period start</span>
        <span class="n">tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># time index for induced power period end</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lp</span><span class="p">[</span><span class="n">fband</span><span class="p">],</span> <span class="n">hp</span><span class="p">[</span><span class="n">fband</span><span class="p">],</span> <span class="n">fps</span><span class="p">[</span><span class="n">fband</span><span class="p">])</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lp</span><span class="p">[</span><span class="n">fband</span><span class="p">],</span> <span class="n">hp</span><span class="p">[</span><span class="n">fband</span><span class="p">],</span> <span class="n">fps</span><span class="p">[</span><span class="n">fband</span><span class="p">]</span><span class="o">*</span><span class="n">ups</span><span class="p">)</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">x2</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">800</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">280</span><span class="p">)</span>
        <span class="n">X2</span><span class="p">,</span> <span class="n">Y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

        <span class="c1"># plot empirical TFR</span>
        <span class="n">tfr_emp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">tfr_emp</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">gavg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">tfr_emp</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">gavg</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">gavg</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">interp2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span><span class="n">gavg</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

        <span class="c1"># normalize colormap</span>
        <span class="n">tt0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">cnorm_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">ttf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">cnorm_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">tfrange</span> <span class="o">=</span> <span class="n">gavg</span><span class="p">[:,</span><span class="n">tt0</span><span class="p">:</span><span class="n">ttf</span><span class="p">]</span>
        <span class="n">_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">tfrange</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
        <span class="n">_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tfrange</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
        <span class="c1">#print(&#39;min =&#39;,_min,&#39;max =&#39;,_max)</span>
        <span class="k">if</span> <span class="n">cnorm</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">_min</span>
            <span class="n">vmax</span> <span class="o">=</span>  <span class="n">maxpwr</span>
            <span class="k">if</span> <span class="n">fband</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">vmax</span> <span class="o">=</span> <span class="n">maxpwr</span><span class="o">/</span><span class="mi">3</span>
        <span class="k">elif</span> <span class="n">cnorm</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">_min</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">_max</span>
        <span class="n">vcenter</span> <span class="o">=</span> <span class="n">coloroffset</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">coloff</span><span class="p">)</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">TwoSlopeNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vcenter</span><span class="o">=</span><span class="n">vcenter</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
        <span class="n">TFR_emp</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
        <span class="n">im_spwr</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">panel</span><span class="p">[</span><span class="n">fband</span><span class="p">]]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X2</span><span class="p">[:,</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">Y2</span><span class="p">[:,</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">TFR_emp</span><span class="p">[:,</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

        <span class="c1"># Thresholding using truncated min-max distribution</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min-max&#39;</span><span class="p">)</span>
            <span class="n">tail</span> <span class="o">=</span> <span class="s1">&#39;two-sided&#39;</span>
            <span class="k">if</span> <span class="n">tail</span> <span class="o">==</span> <span class="s1">&#39;two-sided&#39;</span><span class="p">:</span>
                <span class="n">nullDist_min</span>    <span class="o">=</span> <span class="n">tfr_null</span><span class="p">[:,:,:,:,</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># use the both min and max</span>
                <span class="n">nullDist_min</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">nullDist_min</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># average conditions</span>
                <span class="n">gavg_thr_min</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">nullDist_min</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="mf">2.5</span><span class="p">)</span> <span class="c1"># pool permutations for all frequencies</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff computed using max of null distribution: &#39;</span><span class="p">,</span> <span class="n">gavg_thr_min</span><span class="p">)</span>
                <span class="n">nullDist_max</span>    <span class="o">=</span> <span class="n">tfr_null</span><span class="p">[:,:,:,:,</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># use the both min and max</span>
                <span class="n">nullDist_max</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">nullDist_max</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># average conditions</span>
                <span class="n">gavg_thr_max</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">nullDist_max</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="mf">97.5</span><span class="p">)</span> <span class="c1"># pool permutations for all frequencies</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff computed using max of null distribution: &#39;</span><span class="p">,</span> <span class="n">gavg_thr_max</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">tail</span> <span class="o">==</span> <span class="s1">&#39;single-sided&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff computed using max of null distribution: &#39;</span><span class="p">,</span> <span class="n">gavg_thr_min</span><span class="p">)</span>
                <span class="n">nullDist_max</span>    <span class="o">=</span> <span class="n">tfr_null</span><span class="p">[:,:,:,:,</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># use the both min and max</span>
                <span class="n">nullDist_max</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">nullDist_max</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># average conditions</span>
                <span class="n">gavg_thr_max</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">nullDist_max</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="mi">95</span><span class="p">)</span> <span class="c1"># pool permutations for all frequencies</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff computed using max of null distribution: &#39;</span><span class="p">,</span> <span class="n">gavg_thr_max</span><span class="p">)</span>

        <span class="c1"># Thresholding using whole distribution</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;whole&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;whole-null&#39;</span><span class="p">)</span>
            <span class="n">gavg_null</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">tfr_null</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">gavg_null</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">gavg_null</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.</span> <span class="c1"># just for plotting</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">stats_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">td</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">stats_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">null</span> <span class="o">=</span> <span class="n">gavg_null</span>
            <span class="n">null</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">t0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">null</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">td</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="c1">#print(&#39;H0 shape :&#39;, null.shape)</span>
            <span class="n">null_</span> <span class="o">=</span> <span class="n">null</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">null</span><span class="p">)]</span>
            <span class="n">gavg_thr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">null_</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">prctl</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff computed using whole null distribution: &#39;</span><span class="p">,</span> <span class="n">gavg_thr</span> <span class="p">)</span>

        <span class="n">cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">TFR_emp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">TFR_emp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">gavg_thr_max</span><span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">stats_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">td</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">stats_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">cut</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">t0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">cut</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">td</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">THR</span> <span class="o">=</span>  <span class="n">TFR_emp</span> <span class="o">&gt;=</span> <span class="n">cut</span>
        <span class="n">prctl_cutoff</span> <span class="o">=</span> <span class="n">THR</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">*</span><span class="n">TFR_emp</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="n">ax</span><span class="p">[</span><span class="n">panel</span><span class="p">[</span><span class="n">fband</span><span class="p">]]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X2</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                            <span class="n">Y2</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                            <span class="n">prctl_cutoff</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">calpha</span><span class="p">)</span>


        <span class="n">ax</span><span class="p">[</span><span class="n">panel</span><span class="p">[</span><span class="n">fband</span><span class="p">]]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X2</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                            <span class="n">Y2</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                            <span class="n">THR</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                            <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">,</span>
                            <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span>
                            <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span>
                            <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


        <span class="n">cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">TFR_emp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">TFR_emp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">gavg_thr_min</span><span class="p">)</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">stats_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">td</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">stats_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">cut</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">t0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">cut</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">td</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">THR</span> <span class="o">=</span>  <span class="n">TFR_emp</span> <span class="o">&lt;=</span> <span class="n">cut</span>
        <span class="n">prctl_cutoff</span> <span class="o">=</span> <span class="n">THR</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">*</span><span class="n">TFR_emp</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="n">ax</span><span class="p">[</span><span class="n">panel</span><span class="p">[</span><span class="n">fband</span><span class="p">]]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X2</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">Y2</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">THR</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">,</span>
                    <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                    <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>



        <span class="n">ax</span><span class="p">[</span><span class="n">fband</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (ms)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency (Hz)&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im_spwr</span><span class="p">,</span><span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.15</span><span class="o">*</span><span class="p">(</span><span class="n">panel</span><span class="p">[</span><span class="n">fband</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">]),</span><span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="c1">#ax2 = ax[0].twinx()</span>
        <span class="c1">#ax2.set_yticklabels([])</span>

        <span class="k">if</span> <span class="n">fband</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dvar</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;power (%)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">dvar</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;GPR (%)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fband</span> <span class="o">!=</span><span class="mi">2</span> <span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">fband</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>


    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">sess</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#fig.suptitle(&#39;session: &#39; + str(sess) + &#39; (&#39; + conds[cond] + &#39;)&#39;, fontsize=4, x = 0.25, y=1.05) #y=0.95)</span>
        <span class="n">fname_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="n">paths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="o">+</span> <span class="s1">&#39;uv_tfr_freq_&#39;</span>
                            <span class="o">+</span> <span class="n">conds</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                            <span class="o">+</span> <span class="n">decvars</span><span class="p">[</span><span class="n">dvar</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                            <span class="o">+</span> <span class="s1">&#39;_sess_&#39;</span>
                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sess</span><span class="p">)</span>
                            <span class="o">+</span> <span class="s1">&#39;across&#39;</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">prctl</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnorm_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnorm_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="o">+</span> <span class="n">img_type</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#fig.suptitle(&#39;average (&#39; + conds[cond] + &#39;)&#39;,fontsize=4, x = 0.25, y=1.05) #y=0.95)</span>
        <span class="n">fname_1</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="n">paths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="o">+</span> <span class="s1">&#39;uv_tfr_freq_&#39;</span>
                            <span class="o">+</span> <span class="n">conds</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                            <span class="o">+</span> <span class="n">decvars</span><span class="p">[</span><span class="n">dvar</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                            <span class="o">+</span> <span class="s1">&#39;across&#39;</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">prctl</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnorm_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnorm_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="o">+</span> <span class="n">img_type</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname_1</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fname_1</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Depth</span>
    <span class="n">fr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(([</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">],[</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">]))</span>        <span class="c1"># indices for theta, gamma &amp; high gamma</span>
    <span class="n">ups</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="c1">#fig, ax = plt.subplots(nrows=4, ncols=1,figsize=(2.5, 2),gridspec_kw={&#39;wspace&#39;:0.025, &#39;hspace&#39;:0.05})</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span><span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;wspace&#39;</span><span class="p">:</span><span class="mf">0.025</span><span class="p">,</span> <span class="s1">&#39;hspace&#39;</span><span class="p">:</span><span class="mf">0.05</span><span class="p">})</span>

    <span class="c1">#fig.tight_layout()</span>
    <span class="k">for</span> <span class="n">fband</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>


        <span class="k">if</span> <span class="n">fband</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>

            <span class="c1"># Index channels according to laminar channels</span>
            <span class="k">if</span> <span class="n">cond</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">n_depths</span> <span class="o">=</span> <span class="mi">12</span>
                <span class="n">n_sess</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n_depths</span> <span class="o">=</span> <span class="mi">12</span>
                <span class="n">n_sess</span> <span class="o">=</span> <span class="mi">11</span>



            <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;minmax_oll&#39;</span><span class="p">:</span>
                <span class="n">results</span>       <span class="o">=</span> <span class="mi">1</span>
                <span class="n">tfr_emp</span><span class="p">,</span> <span class="n">tfr_null</span> <span class="o">=</span> <span class="n">load_uv_tfrs</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="p">[],</span> <span class="n">cond</span><span class="p">,</span> <span class="n">fband</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span> <span class="c1"># load tfrs from .npz file</span>

            <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;whole&#39;</span> <span class="ow">or</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;whole_roll&#39;</span><span class="p">:</span>
                <span class="n">results</span>       <span class="o">=</span> <span class="mi">0</span>
                <span class="n">tfr_emp</span><span class="p">,</span> <span class="n">tfr_null</span> <span class="o">=</span> <span class="n">load_uv_tfrs</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span> <span class="p">[],</span> <span class="n">cond</span><span class="p">,</span> <span class="n">fband</span><span class="p">,</span> <span class="n">results</span><span class="p">)</span> <span class="c1"># load tfrs from .npz file</span>


            <span class="c1"># indices for plotting</span>
            <span class="n">x</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">800</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">tps</span><span class="p">[</span><span class="n">fband</span><span class="p">])</span><span class="c1"># time vector</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">stats_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># time index for induced power period start</span>
            <span class="n">tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">stats_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># time index for induced power period end</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lp</span><span class="p">[</span><span class="n">fband</span><span class="p">],</span> <span class="n">hp</span><span class="p">[</span><span class="n">fband</span><span class="p">],</span> <span class="n">fps</span><span class="p">[</span><span class="n">fband</span><span class="p">])</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lp</span><span class="p">[</span><span class="n">fband</span><span class="p">],</span> <span class="n">hp</span><span class="p">[</span><span class="n">fband</span><span class="p">],</span> <span class="n">fps</span><span class="p">[</span><span class="n">fband</span><span class="p">]</span><span class="o">*</span><span class="n">ups</span><span class="p">)</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">x2</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">800</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">280</span><span class="p">)</span>
            <span class="n">X2</span><span class="p">,</span> <span class="n">Y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

            <span class="c1"># plot empirical TFR</span>
            <span class="n">tfr_emp_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">tfr_emp</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">gavg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">tfr_emp_</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">gavg</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">gavg</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>



            <span class="c1"># Cross-frequency TFR</span>
            <span class="n">x</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">800</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">tps</span><span class="p">[</span><span class="n">fband</span><span class="p">])</span>
            <span class="n">tt0</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">stats_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">ttf</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">stats_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">pwr</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">gavg</span><span class="p">[:,</span><span class="n">tt0</span><span class="p">:</span><span class="n">ttf</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1">#print(pwr.shape)</span>
            <span class="n">x</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">lp</span><span class="p">[</span><span class="n">fband</span><span class="p">],</span> <span class="n">hp</span><span class="p">[</span><span class="n">fband</span><span class="p">],</span> <span class="n">num</span> <span class="o">=</span> <span class="n">fps</span><span class="p">[</span><span class="n">fband</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">fband</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">peak</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">pwr</span><span class="p">);</span>
                <span class="c1">#print(peak)</span>
                <span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">fband</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">peak</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">pwr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]);</span>
                <span class="c1">#print(peak)</span>
                <span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">peak</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">pwr</span><span class="p">);</span>
                <span class="n">sigma</span>  <span class="o">=</span> <span class="mi">2</span>
            <span class="n">pk</span>    <span class="o">=</span> <span class="n">peak</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="c1">#print(&#39;peak frequency : &#39;, x[pk])</span>
            <span class="c1">#print(&#39;peak power :&#39;, pwr[pk])</span>
            <span class="c1">#peaks[contrast_idx,fband,0] = x[pk]</span>

            <span class="c1">#tfr emp  :  (30, 12, 16, 113)</span>
            <span class="c1">#tfr null    (1000, 30, 12, 16, 2)</span>

            <span class="k">if</span> <span class="n">pk</span><span class="o">-</span><span class="n">sigma</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">pwr_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pwr</span><span class="p">[</span><span class="n">pk</span><span class="p">:</span><span class="n">pk</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;peak frequency range : &#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">pk</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;power average within peak:&#39;</span><span class="p">,</span> <span class="n">pwr_avg</span><span class="p">)</span>
                <span class="n">davg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">tfr_emp</span><span class="p">[:,:,</span><span class="n">pk</span><span class="p">:</span><span class="n">pk</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span>
                    <span class="n">davg_null</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">tfr_null</span><span class="p">[:,:,:,</span><span class="n">pk</span><span class="p">:</span><span class="n">pk</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;whole&#39;</span><span class="p">:</span>
                    <span class="n">davg_null</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">tfr_null</span><span class="p">[:,:,</span><span class="n">pk</span><span class="p">:</span><span class="n">pk</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">pk</span><span class="o">+</span><span class="n">sigma</span><span class="o">&gt;=</span><span class="n">fps</span><span class="p">[</span><span class="n">fband</span><span class="p">]:</span>
                <span class="n">pwr_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pwr</span><span class="p">[</span><span class="n">pk</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="p">:</span><span class="n">pk</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;peak frequency range : &#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">pk</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;power average within peak:&#39;</span><span class="p">,</span> <span class="n">pwr_avg</span><span class="p">)</span>
                <span class="n">davg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">tfr_emp</span><span class="p">[:,:,</span><span class="n">pk</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="p">:</span><span class="n">pk</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span>
                    <span class="n">davg_null</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">tfr_null</span><span class="p">[:,:,:,</span><span class="n">pk</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="p">:</span><span class="n">pk</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;whole&#39;</span><span class="p">:</span>
                    <span class="n">davg_null</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">tfr_null</span><span class="p">[:,:,</span><span class="n">pk</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="p">:</span><span class="n">pk</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;peak frequency range : &#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">pk</span><span class="o">-</span><span class="n">sigma</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">pk</span><span class="o">+</span><span class="n">sigma</span><span class="p">])</span>
                <span class="n">pwr_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pwr</span><span class="p">[</span><span class="n">pk</span><span class="o">-</span><span class="n">sigma</span><span class="p">:</span><span class="n">pk</span><span class="o">+</span><span class="n">sigma</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;power average within peak:&#39;</span><span class="p">,</span> <span class="n">pwr_avg</span><span class="p">)</span>
                <span class="c1">#print(tfr_emp.shape)</span>
                <span class="n">davg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">tfr_emp</span><span class="p">[:,:,</span><span class="n">pk</span><span class="o">-</span><span class="n">sigma</span><span class="p">:</span><span class="n">pk</span><span class="o">+</span><span class="n">sigma</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span>
                    <span class="n">davg_null</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">tfr_null</span><span class="p">[:,:,:,</span><span class="n">pk</span><span class="o">-</span><span class="n">sigma</span><span class="p">:</span><span class="n">pk</span><span class="o">+</span><span class="n">sigma</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;whole&#39;</span><span class="p">:</span>
                    <span class="n">davg_null</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">tfr_null</span><span class="p">[:,:,</span><span class="n">pk</span><span class="o">-</span><span class="n">sigma</span><span class="p">:</span><span class="n">pk</span><span class="o">+</span><span class="n">sigma</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

            <span class="c1">#print(davg.shape, davg_null.shape)</span>

            <span class="c1">#print(&#39;davg_null : &#39;, davg_null.shape)</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min-max&#39;</span><span class="p">)</span>
                <span class="c1">#stats = get_dpvals_minmax(davg, davg_null, tail = &#39;double-sided&#39;)</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;whole&#39;</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;whole-null&#39;</span><span class="p">)</span>
                <span class="c1">#stats = get_dpvals_whole(davg, davg_null, fband)</span>


            <span class="n">davg</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">davg</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">davg_null</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">davg_null</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1">#print(&#39;depth average  :&#39;, davg.shape)</span>
            <span class="c1">#print(&#39;depth null-average  :&#39;, davg_null.shape) # e.g. depth null-average  : (1000, 12, 4, 2)</span>

            <span class="n">x</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">800</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="n">tps</span><span class="p">[</span><span class="n">fband</span><span class="p">])</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="mi">550</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">550</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">x2</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span> <span class="o">=</span> <span class="o">-</span><span class="mi">800</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">280</span><span class="p">)</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=-</span><span class="mi">550</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="mi">550</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">12</span><span class="o">*</span><span class="n">ups</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">X2</span><span class="p">,</span> <span class="n">Y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

            <span class="c1">#print(davg.shape)</span>
            <span class="n">davg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">davg</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">interp2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">davg</span><span class="p">),</span> <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

            <span class="c1"># Color map normalization</span>
            <span class="n">tt0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">cnorm_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">ttf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">cnorm_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">tfrange</span> <span class="o">=</span> <span class="n">davg</span><span class="p">[:,</span><span class="n">tt0</span><span class="p">:</span><span class="n">ttf</span><span class="p">]</span>
            <span class="n">_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">tfrange</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
            <span class="n">_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tfrange</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span>
            <span class="c1">#print(&#39;min =&#39;,_min,&#39;max =&#39;,_max)</span>
            <span class="k">if</span> <span class="n">cnorm</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="n">_min</span>
                <span class="n">vmax</span> <span class="o">=</span>  <span class="n">maxpwr</span>
                <span class="k">if</span> <span class="n">fband</span><span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">vmax</span> <span class="o">=</span> <span class="n">maxpwr</span><span class="o">/</span><span class="mi">3</span>
            <span class="k">elif</span> <span class="n">cnorm</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">:</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="n">_min</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="n">_max</span>
            <span class="n">vcenter</span> <span class="o">=</span> <span class="n">coloroffset</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">,</span> <span class="n">coloff</span><span class="p">)</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">TwoSlopeNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vcenter</span><span class="o">=</span><span class="n">vcenter</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
            <span class="n">TFR_emp</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
            <span class="n">im_spwr</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">panel</span><span class="p">[</span><span class="n">fband</span><span class="p">]]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X2</span><span class="p">[:,</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">Y2</span><span class="p">[:,</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">TFR_emp</span><span class="p">[:,</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

            <span class="c1">#f_null = interp2d(x, y, np.flipud(davg_null), kind=&#39;linear&#39;)</span>

            <span class="c1"># Thresholding using truncated min-max distribution</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;minmax&#39;</span><span class="p">:</span>

                <span class="n">h0</span>       <span class="o">=</span> <span class="n">davg_null</span><span class="p">[:,:,:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">h0</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">h0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># max across frequency bins</span>
                <span class="n">h0</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">h0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># max across depths</span>
                <span class="n">davg_thr_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">h0</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="mf">2.5</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff computed using min/max of null distribution: &#39;</span><span class="p">,</span> <span class="n">davg_thr_min</span> <span class="p">)</span>
                <span class="n">h0</span>       <span class="o">=</span> <span class="n">davg_null</span><span class="p">[:,:,:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">h0</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">h0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># max across frequency bins</span>
                <span class="n">h0</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">h0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># max across depths</span>
                <span class="n">davg_thr_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">h0</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="mf">97.5</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff computed using min/max of null distribution: &#39;</span><span class="p">,</span> <span class="n">davg_thr_max</span> <span class="p">)</span>


            <span class="c1"># Thresholding using whole distribution</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;whole&#39;</span><span class="p">:</span>
                <span class="n">t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">stats_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">td</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">stats_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">null</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">davg_null</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">null</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">t0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">null</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">td</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">null_</span> <span class="o">=</span> <span class="n">null</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">null</span><span class="p">)]</span>
                <span class="n">davg_thr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">null_</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">prctl</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cutoff computed using whole null distribution: &#39;</span><span class="p">,</span> <span class="n">davg_thr</span> <span class="p">)</span>

            <span class="c1"># Plot increased</span>
            <span class="n">cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">TFR_emp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">TFR_emp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">davg_thr_max</span><span class="p">)</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">stats_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">td</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">stats_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">cut</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">t0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">cut</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">td</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">THR</span> <span class="o">=</span>  <span class="n">TFR_emp</span> <span class="o">&gt;=</span> <span class="n">cut</span>
            <span class="n">prctl_cutoff</span> <span class="o">=</span> <span class="n">THR</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">*</span><span class="n">TFR_emp</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">panel</span><span class="p">[</span><span class="n">fband</span><span class="p">]]</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X2</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                <span class="n">Y2</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                <span class="n">prctl_cutoff</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">calpha</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">panel</span><span class="p">[</span><span class="n">fband</span><span class="p">]]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X2</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">Y2</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                            <span class="n">THR</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                            <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">,</span>
                            <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span>
                            <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span>
                            <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

            <span class="c1"># Plot decreases</span>
            <span class="n">cut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">TFR_emp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">TFR_emp</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">davg_thr_min</span><span class="p">)</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">stats_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">td</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">stats_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">sorter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">cut</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="n">t0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">cut</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">td</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">THR</span> <span class="o">=</span>  <span class="n">TFR_emp</span> <span class="o">&lt;=</span> <span class="n">cut</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">panel</span><span class="p">[</span><span class="n">fband</span><span class="p">]]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X2</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">Y2</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                            <span class="n">THR</span><span class="p">[</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">overlay_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">twindow</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="o">-</span><span class="n">twindow</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                            <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">,</span>
                            <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                            <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span>
                            <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


            <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im_spwr</span><span class="p">,</span> <span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.1</span><span class="o">*</span><span class="p">(</span><span class="n">panel</span><span class="p">[</span><span class="n">fband</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">]),</span><span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fband</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dvar</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;power (%)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dvar</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;GPR (%)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="n">fband</span><span class="p">]</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (ms)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Cortical depth (</span><span class="se">\u03bc</span><span class="s1">m)&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fband</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">fband</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">sess</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#fig.suptitle(&#39;session: &#39; + str(sess) + &#39; (&#39; + conds[cond] + &#39;)&#39;, fontsize=4, x = 0.25, y=1.05)</span>
        <span class="n">fname_2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="n">paths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="o">+</span> <span class="s1">&#39;uv_tfr_depth_&#39;</span>
                            <span class="o">+</span> <span class="n">conds</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                            <span class="o">+</span> <span class="n">decvars</span><span class="p">[</span><span class="n">dvar</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cutoff</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnorm_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnorm_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="o">+</span> <span class="n">img_type</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#fig.suptitle(&#39;average (&#39; + conds[cond] + &#39;)&#39;, fontsize=4, x = 0.25, y=1.05)</span>
        <span class="n">fname_2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="n">paths</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                            <span class="o">+</span> <span class="s1">&#39;uv_tfr_depth_&#39;</span>
                            <span class="o">+</span> <span class="n">conds</span><span class="p">[</span><span class="n">cond</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                            <span class="o">+</span> <span class="n">decvars</span><span class="p">[</span><span class="n">dvar</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">prctl</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>
                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnorm_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnorm_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="o">+</span> <span class="n">img_type</span><span class="p">)</span>



        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname_2</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fname_2</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;fname_1&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>


    <span class="k">return</span>
<br/></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp2d</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>


<span class="n">path</span> <span class="o">=</span>  <span class="s1">&#39;/Users/nicogravel/Documents/Gandalf/MWlamprop/code/notebooks/&#39;</span>
<span class="n">path</span> <span class="o">=</span>  <span class="s1">&#39;/Users/nicogravel/Documents/Gandalf/MWlamprop/lamidec/&#39;</span>
<span class="n">input_path</span> <span class="o">=</span> <span class="s1">&#39;/Users/nicogravel/Documents/Gandalf/MWlamprop/data/results_bckp/&#39;</span> <span class="c1">#&#39;/Users/nicogravel/Documents/Gandalf/MWlamprop/lamidec/&#39;</span>
<span class="c1">#input_path = &#39;/Users/nicogravel/Documents/Websites/MWlamprop_Elena/results/stats/univariate/&#39; # &#39;/Volumes/Gandalf/stats/&#39;</span>
<span class="n">input_path</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/Gandalf/MWlamprop/results/stats/univariate/&#39;</span> <span class="c1"># &#39;/Volumes/Gandalf/stats/&#39;</span>
<span class="n">figure_path</span> <span class="o">=</span> <span class="s1">&#39;/Users/nicogravel/Documents/Gandalf/MWlamprop/results/&#39;</span>
<span class="n">figure_path</span> <span class="o">=</span> <span class="s1">&#39;/Users/nicogravel/Documents/Websites/presentation/reports/figures/nw/&#39;</span>
<span class="n">figure_path</span> <span class="o">=</span> <span class="s1">&#39;/Volumes/Gandalf/MWlamprop/results/figures/univariate/&#39;</span>
<span class="c1">#figure_path = &#39;/Users/nicogravel/Documents/Websites/MWlamprop/results/figures/univariate/&#39;</span>


<span class="n">fbands</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lf&#39;</span><span class="p">,</span><span class="s1">&#39;hf&#39;</span><span class="p">,</span><span class="s1">&#39;hhf&#39;</span><span class="p">,</span><span class="s1">&#39;mua&#39;</span><span class="p">]</span>
<span class="n">fbands</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;low&#39;</span><span class="p">,</span><span class="s1">&#39;high&#39;</span><span class="p">,</span><span class="s1">&#39;higher&#39;</span><span class="p">,</span><span class="s1">&#39;mua&#39;</span><span class="p">]</span>
<span class="c1">#fbands  = [&#39;lf&#39;,&#39;hf&#39;,&#39;higher&#39;,&#39;mua&#39;]</span>

<span class="n">blocks</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;grat&#39;</span><span class="p">,</span> <span class="s1">&#39;nat&#39;</span><span class="p">,</span><span class="s1">&#39;nat&#39;</span><span class="p">,</span><span class="s1">&#39;nat&#39;</span><span class="p">,</span><span class="s1">&#39;nat&#39;</span><span class="p">,</span><span class="s1">&#39;nat&#39;</span><span class="p">]</span>
<span class="n">conds</span>   <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;grat&#39;</span><span class="p">,</span> <span class="s1">&#39;obj&#39;</span><span class="p">,</span> <span class="s1">&#39;bck&#39;</span><span class="p">,</span><span class="s1">&#39;grat_lowcon&#39;</span><span class="p">,</span><span class="s1">&#39;grat_highcon&#39;</span><span class="p">,</span><span class="s1">&#39;bckXobj&#39;</span><span class="p">]</span>
<span class="n">tests</span>   <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_b&#39;</span><span class="p">,</span><span class="s1">&#39;_depth&#39;</span><span class="p">,</span><span class="s1">&#39;_sess&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">cond</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>

    <span class="n">conf</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;paths&#39;</span>    <span class="p">:</span> <span class="p">[</span>
        <span class="n">input_path</span><span class="p">,</span>
        <span class="c1">#&#39;/Users/nicogravel/ocuments/Gandalf/MWlamprop/data/processed/spectral_dec/&#39;</span>
        <span class="c1">#&#39;/Users/nicogravel/Documents/Gandalf/MWlamprop/data/processed/&#39;,</span>
        <span class="c1">#&#39;/Users/nicogravel/Documents/Gandalf/MWlamprop/data/results_bckp/&#39;,</span>
        <span class="n">figure_path</span><span class="p">,</span>
        <span class="n">figure_path</span>
        <span class="p">],</span>
    <span class="s1">&#39;decvars&#39;</span>  <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;spw&#39;</span><span class="p">,</span><span class="s1">&#39;gpr&#39;</span><span class="p">,</span><span class="s1">&#39;spwgpr&#39;</span><span class="p">],</span>
    <span class="s1">&#39;dvar&#39;</span>     <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;cond&#39;</span>     <span class="p">:</span> <span class="n">cond</span><span class="p">,</span>
    <span class="s1">&#39;sess&#39;</span>     <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;coloffset&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>  <span class="c1"># a number between 0-1: [center, theta max, gamma max, hf broadband max]</span>
    <span class="s1">&#39;stats&#39;</span>    <span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;null&#39;</span>     <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;n_perm&#39;</span>   <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;cutoff&#39;</span>   <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;prctl&#39;</span>    <span class="p">:</span> <span class="mf">97.5</span><span class="p">,</span>
    <span class="s1">&#39;p_val&#39;</span>    <span class="p">:</span> <span class="mf">0.0001</span><span class="p">,</span>
    <span class="s1">&#39;cmap&#39;</span>     <span class="p">:</span> <span class="s1">&#39;cubehelix_r&#39;</span><span class="p">,</span>
    <span class="s1">&#39;compute_tfrs&#39;</span>     <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;twindow&#39;</span>    <span class="p">:</span> <span class="p">[</span><span class="mi">65</span><span class="p">,</span> <span class="mi">80</span><span class="p">],</span>
    <span class="s1">&#39;cnorm_range&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span> <span class="c1">#[-200, 1200], #[400, 1000], #[350, 1200],</span>
    <span class="s1">&#39;tclust&#39;</span>    <span class="p">:</span> <span class="p">[</span><span class="mi">70</span><span class="p">,</span> <span class="mi">75</span><span class="p">],</span> <span class="c1">#[350, 1200],</span>
    <span class="s1">&#39;test&#39;</span>    <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;alpha&#39;</span>   <span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="s1">&#39;cnorm&#39;</span>   <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s1">&#39;max_pwr&#39;</span>   <span class="p">:</span> <span class="mi">150</span><span class="p">,</span>
    <span class="s1">&#39;img_type&#39;</span> <span class="p">:</span> <span class="s1">&#39;.png&#39;</span>

    <span class="p">}</span>

    <span class="nb">type</span>         <span class="o">=</span> <span class="s1">&#39;minmax&#39;</span>
    <span class="n">plot_uvtfr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
grat grat
Sites x sessions:  (12, 10)
Site indices:  [[  0  12  24  36  48  60  72  84  96 108]
 [  1  13  25  37  49  61  73  85  97 109]
 [  2  14  26  38  50  62  74  86  98 110]
 [  3  15  27  39  51  63  75  87  99 111]
 [  4  16  28  40  52  64  76  88 100 112]
 [  5  17  29  41  53  65  77  89 101 113]
 [  6  18  30  42  54  66  78  90 102 114]
 [  7  19  31  43  55  67  79  91 103 115]
 [  8  20  32  44  56  68  80  92 104 116]
 [  9  21  33  45  57  69  81  93 105 117]
 [ 10  22  34  46  58  70  82  94 106 118]
 [ 11  23  35  47  59  71  83  95 107 119]]
Depth indices:  [  0  12  24  36  48  60  72  84  96 108]
Load data
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_low_grat_spw_500_minmax.npz
tfr emp  :  (30, 12, 19, 57)
tfr null   : (500, 30, 12, 19, 2)
Plot results
shape emp  : (30, 12, 19, 57)
shape null : (500, 30, 12, 19, 2)
For k=0.5, the point in the range 16.5976135572802-116.462683617347 is: 66.5301485873136
min-max
cutoff computed using max of null distribution:  -18.35742668628657
cutoff computed using max of null distribution:  42.09849547814126
Load data
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_high_grat_spw_500_minmax.npz
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_87051/1667485046.py:182: RuntimeWarning: Mean of empty slice
  tfr_emp = np.squeeze(np.nanmean(tfr_emp,axis=0))
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_87051/1667485046.py:183: RuntimeWarning: Mean of empty slice
  gavg = np.squeeze(np.nanmean(tfr_emp,axis=0))
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_87051/1667485046.py:272: UserWarning: No contour levels were found within the data range.
  ax[panel[fband]].contour(X2[overlay_range[0]:overlay_range[1],twindow[0]:-twindow[1]],
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tfr emp  :  (30, 12, 16, 113)
tfr null   : (500, 30, 12, 16, 2)
Plot results
shape emp  : (30, 12, 16, 113)
shape null : (500, 30, 12, 16, 2)
For k=0.5, the point in the range -0.34972086565076066-129.9169572828355 is: 64.78361820859237
min-max
cutoff computed using max of null distribution:  -22.862598827456562
cutoff computed using max of null distribution:  48.315950339847376
Load data
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_higher_grat_spw_500_minmax.npz
tfr emp  :  (30, 12, 11, 141)
tfr null   : (500, 30, 12, 11, 2)
Plot results
shape emp  : (30, 12, 11, 141)
shape null : (500, 30, 12, 11, 2)
For k=0.5, the point in the range -0.363015774648759-55.80691794187143 is: 27.721951083611337
min-max
cutoff computed using max of null distribution:  -16.40056593188395
cutoff computed using max of null distribution:  18.083226190617243
/Volumes/Gandalf/MWlamprop/results/figures/univariate/uv_tfr_freq_grat_spw_across_97.5_0_1000.png
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_univariate_tfr_plots_4_3.png" src="../_images/notebooks_univariate_tfr_plots_4_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_low_grat_spw_500_minmax.npz
tfr emp  :  (30, 12, 19, 57)
tfr null   : (500, 30, 12, 19, 2)
peak frequency range :  16.0
power average within peak: 59.503313756810016
min-max
For k=0.5, the point in the range 28.454587055887803-167.8297505539238 is: 98.1421688049058
cutoff computed using min/max of null distribution:  -9.599872212238019
cutoff computed using min/max of null distribution:  52.76163922059745
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_high_grat_spw_500_minmax.npz
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_87051/1667485046.py:377: RuntimeWarning: Mean of empty slice
  tfr_emp_ = np.squeeze(np.nanmean(tfr_emp,axis=0))
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_87051/1667485046.py:378: RuntimeWarning: Mean of empty slice
  gavg = np.squeeze(np.nanmean(tfr_emp_,axis=0))
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_87051/1667485046.py:423: RuntimeWarning: Mean of empty slice
  davg = np.squeeze(np.nanmean(tfr_emp[:,:,pk-2*sigma:pk,:],axis=0))
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_87051/1667485046.py:540: UserWarning: No contour levels were found within the data range.
  ax[panel[fband]].contour(X2[overlay_range[0]:overlay_range[1],twindow[0]:-twindow[1]], Y2[overlay_range[0]:overlay_range[1],twindow[0]:-twindow[1]],
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tfr emp  :  (30, 12, 16, 113)
tfr null   : (500, 30, 12, 16, 2)
peak frequency range :  28.0 44.0
power average within peak: 86.6390137791448
min-max
For k=0.5, the point in the range 5.461788075450022-157.32076719625982 is: 81.39127763585492
cutoff computed using min/max of null distribution:  -17.739726357470396
cutoff computed using min/max of null distribution:  53.25284675735072
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_higher_grat_spw_500_minmax.npz
tfr emp  :  (30, 12, 11, 141)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_87051/1667485046.py:434: RuntimeWarning: Mean of empty slice
  davg = np.squeeze(np.nanmean(tfr_emp[:,:,pk-sigma:pk+sigma,:],axis=0))
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
tfr null   : (500, 30, 12, 11, 2)
peak frequency range :  128.0
power average within peak: 17.280991024867717
min-max
For k=0.5, the point in the range -1.701883932392761-69.00914486182131 is: 33.653630464714276
cutoff computed using min/max of null distribution:  -11.780574549869606
cutoff computed using min/max of null distribution:  19.454694273132354
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_87051/1667485046.py:413: RuntimeWarning: Mean of empty slice
  davg = np.squeeze(np.nanmean(tfr_emp[:,:,pk:pk+2*sigma,:],axis=0))
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_univariate_tfr_plots_4_10.png" src="../_images/notebooks_univariate_tfr_plots_4_10.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/Volumes/Gandalf/MWlamprop/results/figures/univariate/uv_tfr_depth_grat_spw_97.5_0_1000.png
nat bck-obj
Sites x sessions:  (12, 11)
Site indices:  [[  0  12  24  36  48  60  72  84  96 108 120]
 [  1  13  25  37  49  61  73  85  97 109 121]
 [  2  14  26  38  50  62  74  86  98 110 122]
 [  3  15  27  39  51  63  75  87  99 111 123]
 [  4  16  28  40  52  64  76  88 100 112 124]
 [  5  17  29  41  53  65  77  89 101 113 125]
 [  6  18  30  42  54  66  78  90 102 114 126]
 [  7  19  31  43  55  67  79  91 103 115 127]
 [  8  20  32  44  56  68  80  92 104 116 128]
 [  9  21  33  45  57  69  81  93 105 117 129]
 [ 10  22  34  46  58  70  82  94 106 118 130]
 [ 11  23  35  47  59  71  83  95 107 119 131]]
Depth indices:  [  0  12  24  36  48  60  72  84  96 108 120]
Load data
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_low_nat_spw_500_minmax.npz
tfr emp  :  (36, 12, 19, 57)
tfr null   : (500, 36, 12, 19, 2)
Plot results
shape emp  : (36, 12, 19, 57)
shape null : (500, 36, 12, 19, 2)
For k=0.5, the point in the range 16.917333506054366-159.51570278265498 is: 88.21651814435467
min-max
cutoff computed using max of null distribution:  -16.902709596092407
cutoff computed using max of null distribution:  38.9965653768703
Load data
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_high_nat_spw_500_minmax.npz
tfr emp  :  (36, 12, 16, 113)
tfr null   : (500, 36, 12, 16, 2)
Plot results
shape emp  : (36, 12, 16, 113)
shape null : (500, 36, 12, 16, 2)
For k=0.5, the point in the range -0.04426262945525695-127.2208749445373 is: 63.58830615754103
min-max
cutoff computed using max of null distribution:  -16.342589131377316
cutoff computed using max of null distribution:  41.72763643271902
Load data
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_higher_nat_spw_500_minmax.npz
tfr emp  :  (36, 12, 11, 141)
tfr null   : (500, 36, 12, 11, 2)
Plot results
shape emp  : (36, 12, 11, 141)
shape null : (500, 36, 12, 11, 2)
For k=0.5, the point in the range -0.7791413238700192-83.96796000225967 is: 41.594409339194826
min-max
cutoff computed using max of null distribution:  -14.317925804650445
cutoff computed using max of null distribution:  29.174153680738666
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_87051/1667485046.py:255: UserWarning: No contour levels were found within the data range.
  ax[panel[fband]].contour(X2[overlay_range[0]:overlay_range[1],twindow[0]:-twindow[1]],
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/Volumes/Gandalf/MWlamprop/results/figures/univariate/uv_tfr_freq_bck-obj_spw_across_97.5_0_1000.png
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_univariate_tfr_plots_4_14.png" src="../_images/notebooks_univariate_tfr_plots_4_14.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_low_nat_spw_500_minmax.npz
tfr emp  :  (36, 12, 19, 57)
tfr null   : (500, 36, 12, 19, 2)
peak frequency range :  7.0 11.0
power average within peak: 48.72408550213469
min-max
For k=0.5, the point in the range 10.556336189686366-311.21502604606457 is: 160.88568111787546
cutoff computed using min/max of null distribution:  -7.117509899157181
cutoff computed using min/max of null distribution:  41.27021542759884
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_high_nat_spw_500_minmax.npz
tfr emp  :  (36, 12, 16, 113)
tfr null   : (500, 36, 12, 16, 2)
peak frequency range :  40.0 56.0
power average within peak: 42.30210196950297
min-max
For k=0.5, the point in the range 0.8756232633192201-312.33170759682434 is: 156.6036654300718
cutoff computed using min/max of null distribution:  -10.227569538464586
cutoff computed using min/max of null distribution:  47.33867201469017
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_higher_nat_spw_500_minmax.npz
tfr emp  :  (36, 12, 11, 141)
tfr null   : (500, 36, 12, 11, 2)
peak frequency range :  128.0
power average within peak: 22.725663180435006
min-max
For k=0.5, the point in the range -1.2570093717337536-188.88046918999788 is: 93.81172990913205
cutoff computed using min/max of null distribution:  -9.844424742370574
cutoff computed using min/max of null distribution:  40.94166470526662
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_univariate_tfr_plots_4_16.png" src="../_images/notebooks_univariate_tfr_plots_4_16.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/Volumes/Gandalf/MWlamprop/results/figures/univariate/uv_tfr_depth_bck-obj_spw_97.5_0_1000.png
nat bck
Sites x sessions:  (12, 11)
Site indices:  [[  0  12  24  36  48  60  72  84  96 108 120]
 [  1  13  25  37  49  61  73  85  97 109 121]
 [  2  14  26  38  50  62  74  86  98 110 122]
 [  3  15  27  39  51  63  75  87  99 111 123]
 [  4  16  28  40  52  64  76  88 100 112 124]
 [  5  17  29  41  53  65  77  89 101 113 125]
 [  6  18  30  42  54  66  78  90 102 114 126]
 [  7  19  31  43  55  67  79  91 103 115 127]
 [  8  20  32  44  56  68  80  92 104 116 128]
 [  9  21  33  45  57  69  81  93 105 117 129]
 [ 10  22  34  46  58  70  82  94 106 118 130]
 [ 11  23  35  47  59  71  83  95 107 119 131]]
Depth indices:  [  0  12  24  36  48  60  72  84  96 108 120]
Load data
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_low_nat_spw_500_minmax.npz
tfr emp  :  (18, 12, 19, 57)
tfr null   : (500, 18, 12, 19, 2)
Plot results
shape emp  : (18, 12, 19, 57)
shape null : (500, 18, 12, 19, 2)
For k=0.5, the point in the range 20.109317469923024-203.88960531890874 is: 111.99946139441589
min-max
cutoff computed using max of null distribution:  -17.118871018851102
cutoff computed using max of null distribution:  59.46144199010044
Load data
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_high_nat_spw_500_minmax.npz
tfr emp  :  (18, 12, 16, 113)
tfr null   : (500, 18, 12, 16, 2)
Plot results
shape emp  : (18, 12, 16, 113)
shape null : (500, 18, 12, 16, 2)
For k=0.5, the point in the range -0.38908749252015046-154.5768860417683 is: 77.09389927462408
min-max
cutoff computed using max of null distribution:  -16.613516632185693
cutoff computed using max of null distribution:  46.57798052724779
Load data
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_higher_nat_spw_500_minmax.npz
tfr emp  :  (18, 12, 11, 141)
tfr null   : (500, 18, 12, 11, 2)
Plot results
shape emp  : (18, 12, 11, 141)
shape null : (500, 18, 12, 11, 2)
For k=0.5, the point in the range -0.9204417712011931-110.05905234148683 is: 54.569305285142825
min-max
cutoff computed using max of null distribution:  -14.227146979824262
cutoff computed using max of null distribution:  30.07389595130418
/Volumes/Gandalf/MWlamprop/results/figures/univariate/uv_tfr_freq_bck_spw_across_97.5_0_1000.png
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_univariate_tfr_plots_4_18.png" src="../_images/notebooks_univariate_tfr_plots_4_18.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_low_nat_spw_500_minmax.npz
tfr emp  :  (18, 12, 19, 57)
tfr null   : (500, 18, 12, 19, 2)
peak frequency range :  7.0 11.0
power average within peak: 64.2782373854334
min-max
For k=0.5, the point in the range 13.19454518820915-392.6130844024455 is: 202.90381479532735
cutoff computed using min/max of null distribution:  -6.519950666196877
cutoff computed using min/max of null distribution:  61.01338245920163
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_high_nat_spw_500_minmax.npz
tfr emp  :  (18, 12, 16, 113)
tfr null   : (500, 18, 12, 16, 2)
peak frequency range :  40.0 56.0
power average within peak: 52.13592015910572
min-max
For k=0.5, the point in the range 0.620564317077168-392.3054282414331 is: 196.46299627925512
cutoff computed using min/max of null distribution:  -9.906855660998795
cutoff computed using min/max of null distribution:  51.921367349741054
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_higher_nat_spw_500_minmax.npz
tfr emp  :  (18, 12, 11, 141)
tfr null   : (500, 18, 12, 11, 2)
peak frequency range :  128.0
power average within peak: 27.879892866038595
min-max
For k=0.5, the point in the range -1.9564393023494264-249.59625344346998 is: 123.81990707056028
cutoff computed using min/max of null distribution:  -9.528954337067821
cutoff computed using min/max of null distribution:  39.95283510890426
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_univariate_tfr_plots_4_20.png" src="../_images/notebooks_univariate_tfr_plots_4_20.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/Volumes/Gandalf/MWlamprop/results/figures/univariate/uv_tfr_depth_bck_spw_97.5_0_1000.png
nat obj
Sites x sessions:  (12, 11)
Site indices:  [[  0  12  24  36  48  60  72  84  96 108 120]
 [  1  13  25  37  49  61  73  85  97 109 121]
 [  2  14  26  38  50  62  74  86  98 110 122]
 [  3  15  27  39  51  63  75  87  99 111 123]
 [  4  16  28  40  52  64  76  88 100 112 124]
 [  5  17  29  41  53  65  77  89 101 113 125]
 [  6  18  30  42  54  66  78  90 102 114 126]
 [  7  19  31  43  55  67  79  91 103 115 127]
 [  8  20  32  44  56  68  80  92 104 116 128]
 [  9  21  33  45  57  69  81  93 105 117 129]
 [ 10  22  34  46  58  70  82  94 106 118 130]
 [ 11  23  35  47  59  71  83  95 107 119 131]]
Depth indices:  [  0  12  24  36  48  60  72  84  96 108 120]
Load data
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_low_nat_spw_500_minmax.npz
tfr emp  :  (18, 12, 19, 57)
tfr null   : (500, 18, 12, 19, 2)
Plot results
shape emp  : (18, 12, 19, 57)
shape null : (500, 18, 12, 19, 2)
For k=0.5, the point in the range 13.638642283512723-115.43102734430711 is: 64.53483481390992
min-max
cutoff computed using max of null distribution:  -16.679690176696155
cutoff computed using max of null distribution:  23.177579277345288
Load data
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_high_nat_spw_500_minmax.npz
tfr emp  :  (18, 12, 16, 113)
tfr null   : (500, 18, 12, 16, 2)
Plot results
shape emp  : (18, 12, 16, 113)
shape null : (500, 18, 12, 16, 2)
For k=0.5, the point in the range 0.22422300392346028-99.86486384730627 is: 50.04454342561487
min-max
cutoff computed using max of null distribution:  -16.502203054839825
cutoff computed using max of null distribution:  38.50010215467453
Load data
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_higher_nat_spw_500_minmax.npz
tfr emp  :  (18, 12, 11, 141)
tfr null   : (500, 18, 12, 11, 2)
Plot results
shape emp  : (18, 12, 11, 141)
shape null : (500, 18, 12, 11, 2)
For k=0.5, the point in the range -0.9346846375341046-57.88161057606243 is: 28.473462969264162
min-max
cutoff computed using max of null distribution:  -14.091638198499261
cutoff computed using max of null distribution:  27.774087220085505
/Volumes/Gandalf/MWlamprop/results/figures/univariate/uv_tfr_freq_obj_spw_across_97.5_0_1000.png
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_univariate_tfr_plots_4_22.png" src="../_images/notebooks_univariate_tfr_plots_4_22.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_low_nat_spw_500_minmax.npz
tfr emp  :  (18, 12, 19, 57)
tfr null   : (500, 18, 12, 19, 2)
peak frequency range :  15.0 19.0
power average within peak: 33.76095131590588
min-max
For k=0.5, the point in the range 12.3366740068419-168.21230508008122 is: 90.27448954346157
cutoff computed using min/max of null distribution:  -6.83294990285604
cutoff computed using min/max of null distribution:  26.667348285752624
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_high_nat_spw_500_minmax.npz
tfr emp  :  (18, 12, 16, 113)
tfr null   : (500, 18, 12, 16, 2)
peak frequency range :  40.0 56.0
power average within peak: 32.468283779900226
min-max
For k=0.5, the point in the range 0.3597851959615941-232.35798695221555 is: 116.35888607408857
cutoff computed using min/max of null distribution:  -9.840437787375391
cutoff computed using min/max of null distribution:  45.57788391918248
stats : /Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_higher_nat_spw_500_minmax.npz
tfr emp  :  (18, 12, 11, 141)
tfr null   : (500, 18, 12, 11, 2)
peak frequency range :  128.0
power average within peak: 17.571433494831425
min-max
For k=0.5, the point in the range -1.8038421230489694-128.16468493652587 is: 63.18042140673846
cutoff computed using min/max of null distribution:  -9.478628347320969
cutoff computed using min/max of null distribution:  41.930494301628976
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_87051/1667485046.py:526: UserWarning: No contour levels were found within the data range.
  ax[panel[fband]].contour(X2[overlay_range[0]:overlay_range[1],twindow[0]:-twindow[1]], Y2[overlay_range[0]:overlay_range[1],twindow[0]:-twindow[1]],
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_univariate_tfr_plots_4_25.png" src="../_images/notebooks_univariate_tfr_plots_4_25.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/Volumes/Gandalf/MWlamprop/results/figures/univariate/uv_tfr_depth_obj_spw_97.5_0_1000.png
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;in dog we trust.
      
      |
      <a href="../_sources/notebooks/univariate_tfr_plots.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>