<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Import libraries and define functions &#8212; tfrStats 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=55c3aa90" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=af2ce170"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo_2.jpg" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Content:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../uvtfrs.html">1. On TFR statistical assessments</a></li>
<li class="toctree-l1"><a class="reference internal" href="univariate_tfr_stats.html">2. Univariate TFR statistics, a mini-tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="multivariate_tfr_stats.html">3. Multiviariate TFR statistics, a mini-tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Package:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">tfrStats</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="Import-libraries-and-define-functions">
<h1>Import libraries and define functions<a class="headerlink" href="#Import-libraries-and-define-functions" title="Permalink to this heading">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
import secrets
a = np.arange(10)
for idx in range(10):
    a_ = np.roll(a, secrets.randbelow(10))
    print(a, a_)
<br/><br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0 1 2 3 4 5 6 7 8 9] [8 9 0 1 2 3 4 5 6 7]
[0 1 2 3 4 5 6 7 8 9] [4 5 6 7 8 9 0 1 2 3]
[0 1 2 3 4 5 6 7 8 9] [5 6 7 8 9 0 1 2 3 4]
[0 1 2 3 4 5 6 7 8 9] [1 2 3 4 5 6 7 8 9 0]
[0 1 2 3 4 5 6 7 8 9] [3 4 5 6 7 8 9 0 1 2]
[0 1 2 3 4 5 6 7 8 9] [7 8 9 0 1 2 3 4 5 6]
[0 1 2 3 4 5 6 7 8 9] [5 6 7 8 9 0 1 2 3 4]
[0 1 2 3 4 5 6 7 8 9] [5 6 7 8 9 0 1 2 3 4]
[0 1 2 3 4 5 6 7 8 9] [6 7 8 9 0 1 2 3 4 5]
[0 1 2 3 4 5 6 7 8 9] [3 4 5 6 7 8 9 0 1 2]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span> secrets.randbelow(10)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
7
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
import random
trialIdx = np.arange(36)
c1 = trialIdx[1::2]
print(c1)
c2 = random.sample(list(c1), len(c1))
print(c2)
<br/><br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ 1  3  5  7  9 11 13 15 17 19 21 23 25 27 29 31 33 35]
[11, 9, 5, 19, 29, 3, 35, 13, 33, 21, 25, 15, 17, 7, 23, 27, 31, 1]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import numpy as np
from tqdm.auto import tqdm
import scipy.io as sio
from numpy import inf
import secrets


def tfr_spw_stats_whole_roll(paths, cond, svar, fband, n_perm):


    &quot;&quot;&quot;
    Permutation based TFR statistical asessement based on whole null distribution

    Function to compute the null distribution keeping the dimensions of the empirical
    distribution. When testing using the whole null distribution, the permutations are
    averaged and the dimensions of the empirical distributions are preserved.

    .. todo::
        *  Implement onset shifting to account for whole triakl (in the current example we pool values from the 400-1000 ms time window).
        *  Implement compatibilityu with Syncopy (for now it relies on ftPool_... .mat containing the TFRs computed in Fieldtrip).


    :param string input_path: path to the .npz file.
    :param in condition: condition index (i.e. 0, 1, 2, 3).
    :param int svar: spectral power or GPR (not implemented here).
    :param int fband: frequency band index (i.e. low, high, higher).
    :param int obs: [nullType, percentile], two integeres: 0 for min-max, 1 for whole, 0-100 percentile.
    :param int correction: 1 for p-values, 2 for cluster corrected p-values.
    :param int cluster_size: cluster size.
    :param float alpha: alpha.

    :return: empirical time frequency representation n_conds x n_sites x n_freqs x n_time (i.e. 30, 12, 16, 113).
    :return: null time frequency representation (i.e. 30, 12, 16, 113  or 1000, 30, 12, 16, 2).
    :rtype: float

    @author: Nicolas Gravel, 19.09.2023

    &quot;&quot;&quot;

    tps = [57,113,141,140]
    fps = [19,16,11,1]
    fbands  = [&#39;low&#39;,&#39;high&#39;,&#39;higher&#39;]
    blocks  = [&#39;grat&#39;, &#39;nat&#39;]
    svars   = [&#39;spw&#39;, &#39;gpr&#39;]
    methods = [&#39;hanning&#39;, &#39;wavelet&#39;,&#39;wavelet&#39;]
    svar = 0
    # Conditions
    if cond == 0:
        block = 0
        n_sess = 10
    # =============================================================================
    else:
        block = 1
        n_sess = 11


    # =============================================================================
    # How the indices are organized within the dataset
    # =============================================================================
    channels = [i for i in range(12*n_sess)] # Total channels
    site_idx = np.zeros((12,n_sess)).astype(np.uint) # Index to sites
    for n in range(12): # for time
            site = [x for x in channels if x%12 == n]
            site_idx[n,:] = site
    print(&#39;site indices :&#39;)
    print(site_idx)

    if fband == 0:
         bs_t0 = -700
         bs_t1 = -100
    elif fband == 1:
         bs_t0 = -700
         bs_t1 = -100
    elif fband == 2:
         bs_t0 = -700
         bs_t1 = -100

    # =============================================================================
    # Empirical TFR
    # =============================================================================
    fname = str(paths[0]
                + &#39;ftPool_&#39;
                + blocks[block] + &#39;_&#39;
                + fbands[fband] + &#39;_&#39;
                + methods[fband] + &#39;.mat&#39;)
    print(fname)
    mat = sio.loadmat(fname)
    dataPool = mat.get(str(&#39;dataLump_&#39; + svars[svar]))



    print(dataPool.shape)
    time =  np.linspace(start = -800, stop = 2000, num = tps[fband])
    b0 = np.searchsorted(time,bs_t0,side=&#39;left&#39;, sorter=None)
    bf = np.searchsorted(time,bs_t1,side=&#39;left&#39;, sorter=None)

    tfr_ = np.zeros((dataPool.shape[0],dataPool.shape[1],12,dataPool.shape[3],dataPool.shape[4]))

    for i_cond in range(dataPool.shape[0]):
        for i_rep in range(dataPool.shape[1]):
            for i_depth in range(12):
                for i_freq in range(dataPool.shape[3]):
                    X = dataPool[i_cond,i_rep,site_idx[i_depth,:],i_freq,:]
                    X = np.nanmean(X,axis=0) # average sessions
                    baseline = dataPool[:,:,site_idx[i_depth,:],i_freq,b0:bf]
                    baseline = np.nanmean(baseline,axis=2) # average time
                    X_bs = np.nanmean(baseline.flatten())
                    tfr_[i_cond,i_rep,i_depth,i_freq,:] =  ((X-X_bs)/X_bs)*100

    tfr_[tfr_ == -inf] = np.nan
    tfr_[tfr_ == inf]  = np.nan
    tfr_emp =  np.nanmean(tfr_,axis=1) # repetition average

    # =============================================================================
    # Null TFR
    # =============================================================================
    time =  np.linspace(start = -800, stop = 2000, num = tps[fband])
    b0 = np.searchsorted(time,bs_t0,side=&#39;right&#39;, sorter=None)
    bf = np.searchsorted(time,bs_t1,side=&#39;right&#39;, sorter=None)
    t0 = np.searchsorted(time,400,side=&#39;left&#39;, sorter=None)
    tf = np.searchsorted(time,1000,side=&#39;left&#39;, sorter=None)
    X_h0   = np.zeros((n_perm,dataPool.shape[1],dataPool.shape[4]))
    tfr_null = np.zeros((dataPool.shape[0],12,dataPool.shape[3],dataPool.shape[4]))

    msg = (str(cond) + &#39; - &#39; + str(blocks[block]) + &#39; - &#39; + str(fbands[fband]))
    choices = np.random.random(n_perm) &gt; 0.5
    for i_cond in tqdm(range(dataPool.shape[0]),desc=msg, position=0):
        for i_depth in range(12):
            for i_freq in range(dataPool.shape[3]):
                for i_perm in range(n_perm):
                    for i_rep in range(dataPool.shape[1]):
                        if choices[i_perm] == True:
                            X = dataPool[i_cond,i_rep,site_idx[i_depth,:],i_freq,:]
                            X = np.nanmean(X,axis=0) # average sessions
                            baseline = dataPool[:,:,site_idx[i_depth,:],i_freq,:]
                            baseline = np.roll(baseline, secrets.randbelow(dataPool.shape[4]))
                            baseline = dataPool[:,:,site_idx[i_depth,:],i_freq,b0:bf]
                            baseline = np.nanmean(baseline,axis=3) # average time
                            X_bs = np.nanmean(baseline.flatten())
                            XX_bs = np.tile(X_bs,[1,dataPool.shape[4]])
                            X_h0[i_perm,i_rep,:] = ((X-XX_bs)/XX_bs)*100
                        elif choices[i_perm] == False:
                            X = dataPool[i_cond,i_rep,site_idx[i_depth,:],i_freq,:]
                            X = np.nanmean(X,axis=0) # average sessions
                            baseline = dataPool[:,:,site_idx[i_depth,:],i_freq,b0:bf]
                            baseline = np.nanmean(baseline,axis=3) # average time
                            X_bs = np.nanmean(baseline.flatten())
                            XX_bs = np.tile(X_bs,[1,dataPool.shape[4]])
                            X_h0[i_perm,i_rep,:] = ((X-XX_bs)/XX_bs)*100
                X_h0[X_h0 == -inf] = np.nan
                X_h0[X_h0 == inf]  = np.nan
                tfr_null[i_cond,i_depth,i_freq,:] = np.nanmean(np.nanmean(X_h0,axis=0),axis=0)


    print(tfr_emp.shape)
    print(tfr_null.shape)

    fname = str(paths[1] + &#39;uvtfr_stats_&#39; +  fbands[fband]  + &#39;_&#39; + blocks[cond] + &#39;_&#39; + svars[svar] + &#39;_&#39; + str(n_perm) + &#39;_roll.npz&#39;)
    print(fname)
    np.savez(fname, tfr_emp, tfr_null)

    return tfr_emp, tfr_null



def tfr_spw_stats_minmax_roll(paths, cond, svar, fband, n_perm):


    &quot;&quot;&quot;
    Permutation based TFR statistical asessement based on min-max

    Function to compute the truncated min-max distribution keeping the permutations
    for each condition and recording site. It captures the variations at the extreme
    of the null ditribution. In the min-max approach the minimum and maximum values
    at each permutations are used.

    .. todo::
        *  Implement onset shifting to account for whole trial (in the current example we pool values from the 400-1000 ms time window).
        *  Implement compatibilityu with Syncopy (for now it relies on ftPool_... .mat containing the TFRs computed in Fieldtrip).


    :param string input_path: path to the .npz file.
    :param in condition: condition index (i.e. 0, 1, 2, 3).
    :param int svar: spectral power or GPR (not implemented here).
    :param int fband: frequency band index (i.e. low, high, higher).
    :param int obs: [nullType, percentile], two integeres: 0 for min-max, 1 for whole, 0-100 percentile.
    :param int correction: 1 for p-values, 2 for cluster corrected p-values.
    :param int cluster_size: cluster size.
    :param float alpha: alpha.

    :return: empirical time frequency representation n_conds x n_sites x n_freqs x n_time (i.e. 30, 12, 16, 113).
    :return: null time frequency representation (i.e. 30, 12, 16, 113  or 1000, 30, 12, 16, 2).
    :rtype: float

    @author: Nicolas Gravel, 19.09.2023
    &quot;&quot;&quot;

    tps = [57,113,141,140]
    fps = [19,16,11,1]
    fbands  = [&#39;low&#39;,&#39;high&#39;,&#39;higher&#39;]
    blocks  = [&#39;grat&#39;, &#39;nat&#39;]
    svars   = [&#39;spw&#39;, &#39;gpr&#39;]
    methods = [&#39;hanning&#39;, &#39;wavelet&#39;,&#39;wavelet&#39;]
    svar = 0
    # Conditions
    if cond == 0:
        block = 0
        n_sess = 10
    # =============================================================================
    else:
        block = 1
        n_sess = 11


    # =============================================================================
    # How the indices are organized within the dataset
    # =============================================================================
    channels = [i for i in range(12*n_sess)] # Total channels
    site_idx = np.zeros((12,n_sess)).astype(np.uint) # Index to sites
    for n in range(12): # for time
            site = [x for x in channels if x%12 == n]
            site_idx[n,:] = site
    print(&#39;site indices :&#39;)
    print(site_idx)

    if fband == 0:
         bs_t0 = -700
         bs_t1 = -100
    elif fband == 1:
         bs_t0 = -700
         bs_t1 = -100
    elif fband == 2:
         bs_t0 = -700
         bs_t1 = -100

    # =============================================================================
    # Empirical TFR
    # =============================================================================
    fname = str(paths[0]
                + &#39;ftPool_&#39;
                + blocks[block] + &#39;_&#39;
                + fbands[fband] + &#39;_&#39;
                + methods[fband] + &#39;.mat&#39;)
    print(fname)
    mat = sio.loadmat(fname)
    dataPool = mat.get(str(&#39;dataLump_&#39; + svars[svar]))



    print(dataPool.shape)
    time =  np.linspace(start = -800, stop = 2000, num = tps[fband])
    b0 = np.searchsorted(time,bs_t0,side=&#39;left&#39;, sorter=None)
    bf = np.searchsorted(time,bs_t1,side=&#39;left&#39;, sorter=None)

    tfr_ = np.zeros((dataPool.shape[0],dataPool.shape[1],12,dataPool.shape[3],dataPool.shape[4]))

    for i_cond in range(dataPool.shape[0]):
        for i_rep in range(dataPool.shape[1]):
            for i_depth in range(12):
                for i_freq in range(dataPool.shape[3]):
                    X = dataPool[i_cond,i_rep,site_idx[i_depth,:],i_freq,:]
                    X = np.nanmean(X,axis=0) # average sessions
                    baseline = dataPool[:,:,site_idx[i_depth,:],i_freq,b0:bf]
                    baseline = np.nanmean(baseline,axis=2) # average time
                    X_bs = np.nanmean(baseline.flatten())
                    tfr_[i_cond,i_rep,i_depth,i_freq,:] =  ((X-X_bs)/X_bs)*100

    tfr_[tfr_ == -inf] = np.nan
    tfr_[tfr_ == inf]  = np.nan
    tfr_emp =  np.nanmean(tfr_,axis=1) # repetition average

    # =============================================================================
    # Null TFR
    # =============================================================================
    time =  np.linspace(start = -800, stop = 2000, num = tps[fband])
    b0  = np.searchsorted(time,bs_t0,side=&#39;right&#39;, sorter=None)
    bf  = np.searchsorted(time,bs_t1,side=&#39;right&#39;, sorter=None)
    t0  = np.searchsorted(time,-200,side=&#39;left&#39;, sorter=None)
    tf  = np.searchsorted(time,1200,side=&#39;left&#39;, sorter=None)
    win = time[t0:tf]
    X_h0   = np.zeros((10,dataPool.shape[3],dataPool.shape[4]))
    tfr_null = np.zeros((n_perm,dataPool.shape[0],12,2))

    msg = (str(cond) + &#39; - &#39; + str(blocks[block]) + &#39; - &#39; + str(fbands[fband]))
    choices = np.random.random(n_perm) &gt; 0.5
    for i_perm in tqdm(range(n_perm),desc=msg, position=0):
        for i_cond in range(dataPool.shape[1]):
            for i_depth in range(12):
                for i_freq in range(dataPool.shape[3]):
                    for i_rep in range(dataPool.shape[1]):
                        if choices[i_perm] == True:
                            X = dataPool[i_cond,i_rep,site_idx[i_depth,:],i_freq,:]
                            X = np.nanmean(X,axis=0) # average sessions
                            baseline = dataPool[:,:,site_idx[i_depth,:],i_freq,:]
                            baseline = np.roll(baseline, secrets.randbelow(dataPool.shape[4]))
                            baseline = dataPool[:,:,site_idx[i_depth,:],i_freq,b0:bf]
                            baseline = np.nanmean(baseline,axis=3) # average time
                            X_bs = np.nanmean(baseline.flatten())
                            XX_bs = np.tile(X_bs,[1,dataPool.shape[4]])
                            X_h0[i_rep,i_freq,:] = ((X-XX_bs)/XX_bs)*100
                        elif choices[i_perm] == False:
                            X = dataPool[i_cond,i_rep,site_idx[i_depth,:],i_freq,:]
                            X = np.nanmean(X,axis=0) # average sessions
                            baseline = dataPool[:,:,site_idx[i_depth,:],i_freq,b0:bf]
                            baseline = np.nanmean(baseline,axis=3) # average time
                            X_bs = np.nanmean(baseline.flatten())
                            XX_bs = np.tile(X_bs,[1,dataPool.shape[4]])
                            X_h0[i_rep,i_freq,:] = ((X-XX_bs)/XX_bs)*100
                X_h0[X_h0 == -inf] = np.nan
                X_h0[X_h0 == inf]  = np.nan
                X = X_h0[:,:,t0:tf] # pool repetitions, frequency bins (all..) and time bins (400-1000ms))
                # save permutation&#39;s min-max for each condition and depth
                tfr_null[i_perm,i_cond,i_depth,0] = np.nanmin(X.flatten())
                tfr_null[i_perm,i_cond,i_depth,1] = np.nanmax(X.flatten())


    print(tfr_emp.shape)
    print(tfr_null.shape)

    fname = str(paths[1] + &#39;uvtfr_stats_&#39; +  fbands[fband]  + &#39;_&#39; + blocks[cond] + &#39;_&#39; + svars[svar] + &#39;_&#39; + str(n_perm) + &#39;_minmax_roll.npz&#39;)
    print(fname)
    np.savez(fname, tfr_emp, tfr_null)

    return tfr_emp, tfr_null
<br/></pre></div>
</div>
</div>
</section>
<section id="Set-paths">
<h1>Set paths<a class="headerlink" href="#Set-paths" title="Permalink to this heading">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>in_path   = &#39;/Volumes/Gandalf/MWlamprop/data/&#39;
out_path  = &#39;/Volumes/Gandalf/MWlamprop/results/stats/univariate/&#39;
paths = [in_path,out_path]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>n_perm = 30
fband  = 1
cond   = 0
tfr_emp, tfr_null  = tfr_spw_stats_whole_roll(paths,cond,0,fband,n_perm)
#tfr_emp, tfr_null = tfr_spw_stats_minmax(paths,cond,0,fband,n_perm)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
site indices :
[[  0  12  24  36  48  60  72  84  96 108]
 [  1  13  25  37  49  61  73  85  97 109]
 [  2  14  26  38  50  62  74  86  98 110]
 [  3  15  27  39  51  63  75  87  99 111]
 [  4  16  28  40  52  64  76  88 100 112]
 [  5  17  29  41  53  65  77  89 101 113]
 [  6  18  30  42  54  66  78  90 102 114]
 [  7  19  31  43  55  67  79  91 103 115]
 [  8  20  32  44  56  68  80  92 104 116]
 [  9  21  33  45  57  69  81  93 105 117]
 [ 10  22  34  46  58  70  82  94 106 118]
 [ 11  23  35  47  59  71  83  95 107 119]]
/Volumes/Gandalf/MWlamprop/data/ftPool_grat_high_wavelet.mat
(30, 10, 120, 16, 113)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_3932/1636253498.py:104: RuntimeWarning: Mean of empty slice
  X = np.nanmean(X,axis=0) # average sessions
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_3932/1636253498.py:106: RuntimeWarning: Mean of empty slice
  baseline = np.nanmean(baseline,axis=2) # average time
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_3932/1636253498.py:112: RuntimeWarning: Mean of empty slice
  tfr_emp =  np.nanmean(tfr_,axis=1) # repetition average
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a600618c34cb422f86e222a08d2f0957", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_3932/1636253498.py:144: RuntimeWarning: Mean of empty slice
  X = np.nanmean(X,axis=0) # average sessions
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_3932/1636253498.py:134: RuntimeWarning: Mean of empty slice
  X = np.nanmean(X,axis=0) # average sessions
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_3932/1636253498.py:152: RuntimeWarning: Mean of empty slice
  tfr_null[i_cond,i_depth,i_freq,:] = np.nanmean(np.nanmean(X_h0,axis=0),axis=0)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(30, 12, 16, 113)
(30, 12, 16, 113)
/Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_high_grat_spw_30_roll.npz
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>n_perm = 100
fband  = 1
cond   = 0
#tfr_emp, tfr_null  = tfr_spw_stats_whole_roll(paths,cond,0,fband,n_perm)
tfr_emp, tfr_null = tfr_spw_stats_minmax_roll(paths,cond,0,fband,n_perm)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
site indices :
[[  0  12  24  36  48  60  72  84  96 108]
 [  1  13  25  37  49  61  73  85  97 109]
 [  2  14  26  38  50  62  74  86  98 110]
 [  3  15  27  39  51  63  75  87  99 111]
 [  4  16  28  40  52  64  76  88 100 112]
 [  5  17  29  41  53  65  77  89 101 113]
 [  6  18  30  42  54  66  78  90 102 114]
 [  7  19  31  43  55  67  79  91 103 115]
 [  8  20  32  44  56  68  80  92 104 116]
 [  9  21  33  45  57  69  81  93 105 117]
 [ 10  22  34  46  58  70  82  94 106 118]
 [ 11  23  35  47  59  71  83  95 107 119]]
/Volumes/Gandalf/MWlamprop/data/ftPool_grat_high_wavelet.mat
(30, 10, 120, 16, 113)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_3932/3094451537.py:262: RuntimeWarning: Mean of empty slice
  X = np.nanmean(X,axis=0) # average sessions
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_3932/3094451537.py:264: RuntimeWarning: Mean of empty slice
  baseline = np.nanmean(baseline,axis=2) # average time
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_3932/3094451537.py:270: RuntimeWarning: Mean of empty slice
  tfr_emp =  np.nanmean(tfr_,axis=1) # repetition average
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "0dd23fe8c8a149d38c6c292d2887bf66", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_3932/3094451537.py:303: RuntimeWarning: Mean of empty slice
  X = np.nanmean(X,axis=0) # average sessions
/var/folders/_n/cg8c3_pj1_778vx80m_y0nww0000gn/T/ipykernel_3932/3094451537.py:293: RuntimeWarning: Mean of empty slice
  X = np.nanmean(X,axis=0) # average sessions
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(30, 12, 16, 113)
(100, 30, 12, 2)
/Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_high_grat_spw_100_minmax_roll.npz
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from tfrStats.plot_tfr_stats import plot_tfr_stats as plot_tfr_stats
from tfrStats.plot_dtfr_stats import plot_dtfr_stats as plot_dtfr_stats

in_path   = &#39;/Volumes/Gandalf/MWlamprop/data/&#39;
out_path  = &#39;/Volumes/Gandalf/MWlamprop/results/stats/univariate/&#39;
paths = [in_path,out_path]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>null         = [2, 95]
alpha        = 0.05
correction   = 1
cluster_size = 0
fband        = 1
cond         = 0
type         = &#39;whole_roll&#39;

plot_tfr_stats(out_path, cond, fband, null, correction, cluster_size, type, alpha)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_high_grat_spw_30_roll.npz
tfr emp  :  (30, 12, 16, 113)
tfr null    (30, 12, 16, 113)
whole-null-roll
cutoff computed using whole null distribution:  108.30031964473675
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_tests_10_1.png" src="../_images/notebooks_tests_10_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>null         = [3, 95]
alpha        = 0.05
correction   = 1
cluster_size = 0
fband        = 1
cond         = 0
type         = &#39;minmax_roll&#39;

plot_tfr_stats(out_path, cond, fband, null, correction, cluster_size, type, alpha)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
/Volumes/Gandalf/MWlamprop/results/stats/univariate/uvtfr_stats_high_grat_spw_100_minmax_roll.npz
tfr emp  :  (30, 12, 16, 113)
tfr null    (100, 30, 12, 2)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">IndexError</span>                                Traceback (most recent call last)
<span class="ansi-green-intense-fg ansi-bold">/Users/nicogravel/Documents/Websites/tfrStats/tfrStats_local/docs/source/notebooks/tests.ipynb Cell 10</span> line <span class="ansi-cyan-fg">9
</span><span class="ansi-green-intense-fg ansi-bold">      &lt;a href=&#39;vscode-notebook-cell:/Users/nicogravel/Documents/Websites/tfrStats/tfrStats_local/docs/source/notebooks/tests.ipynb#X23sZmlsZQ%3D%3D?line=5&#39;&gt;6&lt;/a&gt;</span> cond         = 0
<span class="ansi-green-intense-fg ansi-bold">      &lt;a href=&#39;vscode-notebook-cell:/Users/nicogravel/Documents/Websites/tfrStats/tfrStats_local/docs/source/notebooks/tests.ipynb#X23sZmlsZQ%3D%3D?line=6&#39;&gt;7&lt;/a&gt;</span> type         = &#39;minmax_roll&#39;
<span class="ansi-green-fg">----&gt; &lt;a href=&#39;vscode-notebook-cell:/Users/nicogravel/Documents/Websites/tfrStats/tfrStats_local/docs/source/notebooks/tests.ipynb#X23sZmlsZQ%3D%3D?line=8&#39;&gt;9&lt;/a&gt;</span> plot_tfr_stats(out_path, cond, fband, null, correction, cluster_size, type, alpha)

File <span class="ansi-green-fg">~/Documents/Websites/tfrStats/tfrStats_local/tfrStats/plot_tfr_stats.py:100</span>, in <span class="ansi-cyan-fg">plot_tfr_stats</span><span class="ansi-blue-fg">(input_path, cond, fband, null, correction, cluster_size, type, alpha)</span>
<span class="ansi-green-intense-fg ansi-bold">     97</span> tfr_emp, tfr_null = load_uv_tfrs(input_path, [], cond, fband, results) # load tfrs from .npz file
<span class="ansi-green-intense-fg ansi-bold">     99</span> if correction == 1:
<span class="ansi-green-fg">--&gt; 100</span>     stats = get_pvals_minmax(tfr_emp, tfr_null, tail = &#39;single-sided&#39;)
<span class="ansi-green-intense-fg ansi-bold">    102</span> if correction == 2:
<span class="ansi-green-intense-fg ansi-bold">    103</span>     stats = get_pvals_minmax(tfr_emp, tfr_null, tail = &#39;single-sided&#39;)

File <span class="ansi-green-fg">~/Documents/Websites/tfrStats/tfrStats_local/tfrStats/get_pvals_minmax.py:32</span>, in <span class="ansi-cyan-fg">get_pvals_minmax</span><span class="ansi-blue-fg">(tfr_emp, tfr_null, tail)</span>
<span class="ansi-green-intense-fg ansi-bold">     30</span>     nullDist  = tfr_null[:,:,:,:,:]  # use the both min and max
<span class="ansi-green-intense-fg ansi-bold">     31</span> elif tail == &#39;single-sided&#39;:
<span class="ansi-green-fg">---&gt; 32</span>     nullDist   = tfr_null[:,:,:,:,1]  # use the max
<span class="ansi-green-intense-fg ansi-bold">     33</span> nullDist     = np.nanmean(nullDist,axis=1) # average conditions
<span class="ansi-green-intense-fg ansi-bold">     34</span> nullDist     = np.amax(nullDist,axis=1) # max across sites

<span class="ansi-red-fg">IndexError</span>: too many indices for array: array is 4-dimensional, but 5 were indexed
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_tests_11_2.png" src="../_images/notebooks_tests_11_2.png" />
</div>
</div>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;in dog we trust.
      
      |
      <a href="../_sources/notebooks/tests.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>